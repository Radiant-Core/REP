```
REP: 6
Title: Post-Quantum Cryptography Upgrade Path
Author: Radiant Community
Status: Draft
Type: Standard
Created: 2026-01-29
License: MIT
```

## Abstract

This REP defines a phased upgrade path for Radiant to transition from current ECDSA (secp256k1) digital signatures to post-quantum cryptographic schemes. The proposal prioritizes designing upgrade hooks and new output types that can enforce post-quantum (PQ) signatures in the future, while maintaining backward compatibility during a gradual migration period. The immediate focus is on infrastructure preparation—script extensions, wallet tooling, and consensus rule flexibility—rather than immediate replacement of existing cryptographic primitives. SHA-256 remains secure for the foreseeable future with effective 128-bit security post-Grover, making signature algorithm migration the primary concern.

## Specification

### Phase 1: Infrastructure Preparation (Years 1-2)

#### 1.1 New Output Types

Introduce a new witness version for PQ-compatible outputs:

```
OP_PQWITNESS <version> <pubkey_hash>
```

- **Version 0x01**: Reserved for lattice-based schemes (e.g., CRYSTALS-Dilithium)
- **Version 0x02**: Reserved for hash-based schemes (e.g., SPHINCS+)
- **Version 0x03**: Reserved for hybrid schemes (ECDSA + PQ)

#### 1.2 Script Extensions

New opcodes to support PQ signature verification:

| Opcode | Hex | Description |
|--------|-----|-------------|
| OP_CHECKSIGPQ | 0xBA | Verify a post-quantum signature |
| OP_CHECKSIGPQVERIFY | 0xBB | OP_CHECKSIGPQ followed by OP_VERIFY |
| OP_CHECKMULTISIGPQ | 0xBC | Multi-signature PQ verification |
| OP_CHECKSIGHYBRID | 0xBD | Verify both ECDSA and PQ signatures |

#### 1.3 Transaction Format Extensions

Extend transaction format to accommodate larger signatures:

```
struct PQWitness {
    uint8_t  version;           // PQ scheme version
    uint16_t sig_length;        // Signature length (up to 65535 bytes)
    bytes    signature;         // Variable-length PQ signature
    uint16_t pubkey_length;     // Public key length
    bytes    pubkey;            // Variable-length PQ public key
}
```

### Phase 2: Opt-In PQ Path (Years 2-4)

#### 2.1 Hybrid Signature Scheme

During transition, support hybrid outputs requiring both signatures:

```
<ecdsa_sig> <pq_sig> <ecdsa_pubkey> <pq_pubkey> OP_CHECKSIGHYBRID
```

This provides:
- Immediate quantum resistance for new outputs
- Fallback to classical security if PQ scheme is compromised
- Gradual ecosystem adoption

#### 2.2 Address Format

New address prefix for PQ-enabled addresses:

| Type | Prefix | Length | Description |
|------|--------|--------|-------------|
| P2PQPKH | `rq1` | Variable | Pay to PQ Public Key Hash |
| P2PQSH | `rq3` | Variable | Pay to PQ Script Hash |
| Hybrid | `rh1` | Variable | Hybrid ECDSA + PQ |

### Phase 3: Mandatory Migration (Years 5+)

#### 3.1 Soft Fork Activation

Consensus rules enforcing PQ signatures for new outputs:

1. **Block N**: PQ outputs become standard (relay policy)
2. **Block N+X**: New coinbase outputs must be PQ-compatible
3. **Block N+Y**: All new outputs must be PQ-compatible
4. **Block N+Z**: Legacy ECDSA-only outputs deprecated for new transactions

#### 3.2 Legacy Output Handling

Existing ECDSA outputs remain spendable indefinitely but:
- Wallets SHOULD migrate funds to PQ addresses
- Exchanges and custodians MUST migrate within defined timeline
- Long-term cold storage SHOULD prioritize migration

### Candidate PQ Algorithms

| Algorithm | Type | Signature Size | Public Key Size | Security Level |
|-----------|------|----------------|-----------------|----------------|
| CRYSTALS-Dilithium | Lattice | 2,420 bytes | 1,312 bytes | NIST Level 2 |
| Falcon-512 | Lattice | 690 bytes | 897 bytes | NIST Level 1 |
| SPHINCS+-128f | Hash-based | 17,088 bytes | 32 bytes | NIST Level 1 |
| SPHINCS+-128s | Hash-based | 7,856 bytes | 32 bytes | NIST Level 1 |

**Recommended Primary**: CRYSTALS-Dilithium (balanced size/performance)  
**Recommended Fallback**: SPHINCS+ (conservative, hash-based security assumptions)

## Motivation

### Current Quantum Threat Assessment

#### Grover's Algorithm (Search Optimization)

- **Impact**: Reduces SHA-256 preimage resistance from 2^256 to ~2^128 operations
- **Status**: Theoretical—requires large-scale, fault-tolerant quantum computers
- **Timeline**: Estimates range from 10-30+ years for practical implementation
- **Mitigation**: 2^128 security remains strong against classical and near-term quantum attacks

#### Shor's Algorithm (Factoring/Discrete Log)

- **Impact**: No direct effect on SHA-256 (targets RSA/ECC)
- **Relevance**: Would break ECDSA digital signatures, not hash functions
- **Timeline**: Potentially achievable before Grover becomes practical

### Radiant's Quantum Exposure

#### Primary Vulnerabilities

1. **Digital Signatures (ECDSA secp256k1)**: Directly vulnerable to Shor's algorithm
2. **Hash Collisions**: Theoretical reduction via Grover, but practically infeasible
3. **Mining (Proof-of-Work)**: Could be accelerated but requires massive quantum resources

#### Security Margin Analysis

| Metric | Current | Post-Grover | Assessment |
|--------|---------|-------------|------------|
| SHA-256 | 2^256 ops | 2^128 ops | Robust for foreseeable future |
| ECDSA | 2^128 ops | Broken | Critical—requires migration |

### Why Act Now

1. **"Harvest Now, Decrypt Later"**: Adversaries may store encrypted/signed data for future quantum attacks
2. **Long Migration Timelines**: Ecosystem-wide changes require years of coordination
3. **Standardization Maturity**: NIST PQ standards finalized (2024), implementations maturing
4. **Avoid Rushed Decisions**: Proactive preparation prevents panic-driven, poorly-tested migrations

## Rationale

### Design Decisions

#### Upgrade Hooks Over Immediate Replacement

The proposal prioritizes infrastructure preparation rather than immediate ECDSA replacement because:

1. **No Imminent Threat**: Fault-tolerant quantum computers capable of breaking ECDSA are 10+ years away
2. **Algorithm Maturity**: PQ schemes need more real-world deployment experience
3. **Ecosystem Readiness**: Wallets, libraries, and tooling need gradual adaptation
4. **Key/Signature Sizes**: PQ signatures are 10-100x larger than ECDSA, requiring protocol adjustments

#### Hybrid Approach During Transition

Requiring both ECDSA and PQ signatures during transition:

1. **Defense in Depth**: If either scheme fails, the other provides security
2. **Smooth Migration**: Users can adopt at their own pace
3. **Backward Compatibility**: Existing infrastructure continues working
4. **Risk Mitigation**: Protects against both classical and quantum adversaries

#### Algorithm Selection Rationale

**CRYSTALS-Dilithium** as primary recommendation:
- NIST standardized (FIPS 204)
- Reasonable signature/key sizes for blockchain use
- Strong security proofs based on lattice problems
- Wide library support and implementation experience

**SPHINCS+** as fallback:
- Conservative security assumptions (hash functions only)
- No novel mathematical assumptions
- Larger signatures acceptable for cold storage/high-value transactions

### Alternatives Considered

#### Immediate Hard Fork to PQ-Only

**Rejected** because:
- Unnecessary given 10+ year threat timeline
- Would break all existing wallets and tooling
- Insufficient ecosystem testing time
- Algorithm choice could prove suboptimal

#### SHA-512/SHA-3 Migration

**Deferred** because:
- SHA-256 with 128-bit post-quantum security is adequate
- Hash function migration is lower priority than signatures
- Can be addressed in future REP if needed

#### Commit-Delay Schemes

**Considered for future phases**:
- Commit transaction hash, reveal after confirmation
- Protects against "harvest now, decrypt later" for in-flight transactions
- Adds complexity; may be unnecessary with hybrid approach

## Backwards Compatibility

### Fully Backward Compatible (Phase 1-2)

- All existing ECDSA outputs remain valid and spendable
- Legacy wallets continue functioning without updates
- New PQ features are opt-in

### Migration Path

| User Type | Action Required | Timeline |
|-----------|-----------------|----------|
| Individual Users | Migrate to PQ addresses when wallets support | Optional until Phase 3 |
| Exchanges | Upgrade infrastructure, migrate hot wallets | Before Phase 3 |
| Cold Storage | Plan migration strategy, prioritize high-value | Before Phase 3 activation |
| Smart Contracts | Audit for PQ compatibility, plan upgrades | During Phase 2 |

### Wallet Compatibility Matrix

| Wallet Version | Phase 1 | Phase 2 | Phase 3 |
|----------------|---------|---------|---------|
| Legacy (pre-PQ) | Full support | Full support | Send only (no new PQ) |
| PQ-Aware | Full support | Full support | Full support |
| PQ-Native | Full support | Full support | Full support |

## Reference Implementation

### Implementation Milestones

#### Milestone 1: Specification Finalization
- [ ] Finalize opcode assignments
- [ ] Complete address format specification
- [ ] Define witness structure

#### Milestone 2: Library Support
- [ ] radiantjs PQ signature support
- [ ] RadiantScript PQ opcodes
- [ ] Wallet SDK updates

#### Milestone 3: Node Implementation
- [ ] Consensus rule changes (disabled by default)
- [ ] Mempool policy for PQ transactions
- [ ] RPC extensions for PQ operations

#### Milestone 4: Wallet Integration
- [ ] Photonic Wallet PQ support
- [ ] Electron Wallet PQ support
- [ ] Hardware wallet coordination

#### Milestone 5: Testing & Audit
- [ ] Testnet deployment
- [ ] Security audit of implementations
- [ ] Ecosystem-wide integration testing

### Code Repositories

Reference implementations will be developed in:
- `radiant-node`: Consensus and validation
- `radiantjs`: JavaScript library
- `RadiantScript`: Smart contract support

## Security Considerations

### Threat Model

#### Near-Term (0-10 years)
- **Quantum Threat**: Minimal—no cryptographically relevant quantum computers
- **Classical Threat**: Standard ECDSA security assumptions hold
- **Recommendation**: Begin infrastructure preparation, opt-in PQ adoption

#### Medium-Term (10-20 years)
- **Quantum Threat**: Possible early fault-tolerant systems
- **Classical Threat**: Unchanged
- **Recommendation**: Hybrid signatures mandatory for high-value transactions

#### Long-Term (20+ years)
- **Quantum Threat**: Likely cryptographically relevant quantum computers
- **Classical Threat**: ECDSA potentially broken
- **Recommendation**: Full PQ migration complete

### Attack Vectors

#### Harvest Now, Decrypt Later
- **Risk**: Adversaries store blockchain data for future quantum decryption
- **Mitigation**: Early adoption of PQ addresses for long-term holdings

#### Implementation Vulnerabilities
- **Risk**: New PQ code introduces bugs
- **Mitigation**: Extensive testing, audits, gradual rollout

#### Side-Channel Attacks
- **Risk**: PQ implementations may leak information
- **Mitigation**: Use constant-time implementations, hardware wallet support

#### Algorithm Breaks
- **Risk**: Chosen PQ scheme found vulnerable
- **Mitigation**: Hybrid approach, algorithm agility in protocol design

### Cryptographic Agility

The proposal maintains cryptographic agility through:

1. **Version Fields**: New PQ versions can be added without hard forks
2. **Hybrid Mode**: Fallback to ECDSA if PQ scheme fails
3. **Multiple Algorithm Support**: Not locked to single PQ scheme
4. **Soft Fork Activation**: Gradual, reversible deployment

### Hash Function Considerations

While SHA-256 remains secure:

- Post-Grover security of ~128 bits is considered adequate
- Future REP may address SHA-512/SHA-3 migration if needed
- Mining difficulty adjustment naturally handles any quantum speedup
- Address hashing provides additional protection layer

## Copyright

This document is licensed under the MIT License.
