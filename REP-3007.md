```
REP: 3007
Title: Encrypted Content Test Vectors (AEAD + Hashing)
Author: C. Donnachie
Status: Draft
Type: Informational
Created: 2026-01-24
Requires: REP-3006
License: MIT
Original: RIP-GLYPH-0007a
```

## Abstract

This document provides deterministic test vectors for **AEAD encryption** and **ciphertext hashing** used by encrypted Glyphs.

> Note: REP-3006 RECOMMENDS `xchacha20poly1305`. Python's widely available `cryptography` library provides
> `chacha20poly1305` (IETF, 12-byte nonce) and `aes-256-gcm`. Therefore this companion publishes
> **reference vectors for AES-256-GCM and ChaCha20-Poly1305 (IETF)**.  
> A future revision SHOULD add official XChaCha20-Poly1305 vectors once a canonical implementation is selected.

---

## Motivation

Deterministic test vectors ensure implementations produce identical ciphertext and hashes, enabling interoperability.

## Specification

### Common Inputs

Plaintext (UTF-8 bytes):

```text
hello
```

AAD (bytes):

```text
glyph-v2-aad
```

Ciphertext hash:

- `ciphertext_hash = SHA256(ciphertext_and_tag_bytes)`
- Store `ciphertext_hash` in `content.*.hash.hex`

---

### Vector A — AES-256-GCM

Key (32 bytes, hex):

```text
000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f
```

Nonce (12 bytes, hex):

```text
1af38c2dc2b96ffdd8669409
```

Ciphertext||Tag (hex):

```text
ca15f2a1588d11564448fdd16b04a7a297d91e3ef9
```

SHA256(ciphertext||tag) (hex):

```text
fa402a9f01a52c068dfad98b5e89deb93ec4163536006e69b55a1c0d7a144e5a
```

---

### Vector B — ChaCha20-Poly1305 (IETF)

Key (32 bytes, hex):

```text
1c9240a5eb55d38af333888604f6b5f0473917c1402b80099dca5cbc207075c0
```

Nonce (12 bytes, hex):

```text
000000000102030405060708
```

Ciphertext||Tag (hex):

```text
45ab9e1c68f8971fd00be0579c50d7cf532054a724
```

SHA256(ciphertext||tag) (hex):

```text
39a324fd2141132b25375bc979ac54bb07fcc63e5a79d14ee87bc5cef345c6ac
```

---

### How to Use in a Glyph

Example (showing only `content.primary` + `crypto` essentials):

```json
{
  "v": 2,
  "type": "text",
  "name": "Encrypted Hello",
  "content": {
    "mode": "inline",
    "primary": {
      "path": "hello.enc",
      "mime": "application/octet-stream",
      "size": 21,
      "hash": {
        "algo": "sha256",
        "hex": "fa402a9f01a52c068dfad98b5e89deb93ec4163536006e69b55a1c0d7a144e5a"
      },
      "encoding": "raw",
      "compression": "none"
    }
  },
  "policy": { "renderable": true, "executable": false },
  "crypto": {
    "mode": "encrypted",
    "aead": "aes-256-gcm",
    "nonce": "1af38c2dc2b96ffdd8669409",
    "aad": { "mode": "bytes", "bytes": "676c7970682d76322d616164" },
    "key": { "format": "raw", "kdf": "none" }
  }
}
```

---

### Vector C — scrypt Passphrase Derivation

#### Inputs

Passphrase (UTF-8):

```text
correct horse battery staple
```

Salt (16 bytes, hex):

```text
d4e56740f876aef8c010b86a40d5f567
```

scrypt parameters:

- N = 2^14 (16384)
- r = 8
- p = 1
- dkLen = 32

#### Derived CEK (hex)

```text
fdbabe1c9d3472007856e7190d01e9fe7c6ad7cbc8237830e77376634b373162
```

#### Metadata Example

```json
"crypto": {
  "mode": "encrypted",
  "aead": "aes-256-gcm",
  "nonce": "...",
  "aad": { "mode": "none" },
  "key": {
    "format": "raw",
    "kdf": "scrypt",
    "kdf_params": {
      "salt": "d4e56740f876aef8c010b86a40d5f567",
      "N": 16384,
      "r": 8,
      "p": 1,
      "dkLen": 32
    }
  }
}
```

---

### Vector D — AAD Field Encoding

#### Inputs

Given metadata fields:

- `content.primary.path` = `"hello.enc"`
- `content.primary.hash.hex` = `"fa402a9f01a52c068dfad98b5e89deb93ec4163536006e69b55a1c0d7a144e5a"`

AAD fields array:

```json
["content.primary.path", "content.primary.hash.hex"]
```

#### Encoding Procedure

1. Encode `"hello.enc"` as UTF-8: `68656c6c6f2e656e63`
2. Append null byte: `00`
3. Encode hash hex as UTF-8: `6661343032613966...` (64 hex chars = 64 bytes)
4. Concatenate (no trailing null)

#### Computed AAD (hex)

```text
68656c6c6f2e656e63006661343032613966303161353263303638646661643938623565383964656239336563343136333533363030366536396235356131633064376131343465356100
```

#### AAD Length

74 bytes (9 + 1 + 64)

---

### Vector E — Decryption Failure (Wrong Key)

#### Setup

Using Vector A ciphertext with wrong key:

Wrong key (hex):

```text
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
```

#### Expected Result

- AEAD decryption MUST fail (authentication tag mismatch)
- Implementations MUST NOT return any plaintext
- Implementations SHOULD return an authentication error

---

## Backwards Compatibility

These test vectors are specific to REP-3006. They do not affect other REPs.

## Rationale

Vectors cover the most commonly available AEAD algorithms in standard cryptography libraries.

## Reference Implementation

See REP-3006 for algorithm specifications.

## Security Considerations

Test vectors include a wrong-key test to ensure implementations fail securely when authentication fails.

## Implementation Verification Checklist

Implementers SHOULD verify:

- [ ] AES-256-GCM produces exact ciphertext||tag from Vector A
- [ ] ChaCha20-Poly1305 produces exact ciphertext||tag from Vector B
- [ ] SHA256 of ciphertext||tag matches expected hash
- [ ] scrypt with given params produces CEK from Vector C
- [ ] AAD field encoding produces exact bytes from Vector D
- [ ] Decryption fails gracefully with wrong key (Vector E)

## Copyright

This document is licensed under the MIT License.
